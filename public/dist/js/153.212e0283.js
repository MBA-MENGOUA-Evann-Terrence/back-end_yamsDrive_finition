"use strict";(self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]=self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]||[]).push([[153],{3788:function(e,t,s){s.r(t),s.d(t,{default:function(){return P}});var a=s(6768);const i={class:"container-fluid"},r={class:"row"},n={class:"col-12"};function o(e,t,s,o,c,l){const d=(0,a.g2)("RecentDocumentsView");return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("div",r,[(0,a.Lk)("div",n,[(0,a.bF)(d)])])])}var c=s(5130),l=s(4232);const d={class:"document-view-container"},u={class:"view-header"},p={class:"card document-management-card"},h={class:"card-body"},m={class:"custom-search-wrapper"},f={class:"file-cell"},g={class:"ms-2"},v={class:"badge bg-secondary"},b={class:"p-2 rounded badge badge-secondary"},y={key:0},w={key:1,class:"text-muted"},k={key:2,class:"text-muted"},_={key:0},x={key:1};function D(e,t,s,i,r,n){const o=(0,a.g2)("FileIcon"),D=(0,a.g2)("AsdecodeTable");return(0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("div",u,[t[3]||(t[3]=(0,a.Lk)("h1",{class:"view-title"},"Documents RÃ©cents",-1)),(0,a.Lk)("button",{id:"refreshrecent",onClick:t[0]||(t[0]=(...t)=>e.refreshData&&e.refreshData(...t)),class:"d-none"},"RafraÃ®chir")]),(0,a.Lk)("div",p,[(0,a.Lk)("div",h,[(0,a.Lk)("div",m,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.searchQuery=t),class:"form-control form-control-sm",placeholder:"Rechercher par nom de fichier..."},null,512),[[c.Jo,e.searchQuery]]),e.searchQuery?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"btn btn-sm btn-secondary",onClick:t[2]||(t[2]=(...t)=>e.clearSearch&&e.clearSearch(...t))},t[4]||(t[4]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1),(0,a.eW)(" Effacer ",-1)]))):(0,a.Q3)("",!0)]),(0,a.bF)(D,{ref:"datatable",columns:e.columns,url:e.computedUrl,"api-client":e.apiClient,table:"recent",onSetTotalRecords:e.updateLines,onRowClick:e.showLine,onSetSelectedRows:e.getSelection,"show-top-stats":!1,"show-bottom-stats":!1},{nom:(0,a.k6)(e=>[(0,a.Lk)("div",f,[(0,a.bF)(o,{fileName:e.data.nom},null,8,["fileName"]),(0,a.Lk)("span",g,(0,l.v_)(e.data.nom),1)])]),type_lisible:(0,a.k6)(t=>[(0,a.Lk)("span",v,(0,l.v_)(e.getFileType(t.data.nom)),1)]),taille:(0,a.k6)(t=>[(0,a.Lk)("span",null,(0,l.v_)(e.formatSize(t.data.taille)),1)]),updated_at:(0,a.k6)(t=>[(0,a.Lk)("span",b,(0,l.v_)(e.formatDate(t.data.updated_at)),1)]),service:(0,a.k6)(e=>[e.data.service?((0,a.uX)(),(0,a.CE)("span",y,(0,l.v_)(e.data.service.nom),1)):e.data.service_id?((0,a.uX)(),(0,a.CE)("span",w,"Service #"+(0,l.v_)(e.data.service_id),1)):((0,a.uX)(),(0,a.CE)("span",k,"Aucun service"))]),proprietaire:(0,a.k6)(e=>["received"===e.data.source&&e.data.user?((0,a.uX)(),(0,a.CE)("span",_,(0,l.v_)(e.data.user.prenom)+" "+(0,l.v_)(e.data.user.nom),1)):((0,a.uX)(),(0,a.CE)("span",x,"Vous"))]),_:1},8,["columns","url","api-client","onSetTotalRecords","onRowClick","onSetSelectedRows"])])])])}s(8111),s(1701),s(4603),s(7566),s(8721);var C=s(139),L=s(9069),F=s(1526),E=(0,a.pM)({name:"RecentDocumentsView",components:{FileIcon:L.A},data(){return{apiClient:F.A,isLoading:!1,recentDocuments:[],lines:0,selection:[],searchQuery:"",searchTimeout:null,filters:{},columns:[{key:"nom",label:"Nom",sortable:!0,className:"",filterable:!0},{key:"type_lisible",label:"Type",sortable:!0,className:"",filterable:!0},{key:"taille",label:"Taille",sortable:!0,className:"",filterable:!0},{key:"service",label:"Service",sortable:!0,className:"",filterable:!0},{key:"proprietaire",label:"PropriÃ©taire",sortable:!0,className:"",filterable:!0},{key:"updated_at",label:"Date",sortable:!0,className:"",filterable:!0}]}},computed:{computedUrl(){const e="/api/documents/recent",t=new URLSearchParams;this.searchQuery&&t.append("q",this.searchQuery),this.filters.type&&t.append("type",this.filters.type),this.filters.person&&t.append("user_id",this.filters.person.toString()),this.filters.service&&t.append("service_id",this.filters.service.toString());const s=t.toString();return s?`${e}?${s}`:e}},watch:{searchQuery(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.$nextTick(()=>{this.$refs.datatable&&this.$refs.datatable.fetchData&&this.$refs.datatable.fetchData()})},500)}},mounted(){window.addEventListener("global-filters-change",this.handleGlobalFiltersChange);try{const e=localStorage.getItem("globalFilters");e&&(this.filters=JSON.parse(e),this.$nextTick(()=>{this.applyFilters(this.filters)}))}catch(e){console.error("Erreur lors de la restauration des filtres:",e)}},beforeUnmount(){window.removeEventListener("global-filters-change",this.handleGlobalFiltersChange)},methods:{async fetchRecentDocuments(){this.isLoading=!0;try{const[e,t]=await Promise.all([this.apiClient.get("/documents/recent/published"),this.apiClient.get("/documents/recent/received")]),s=(e.data.data||e.data).map(e=>({...e,source:"published"})),a=(t.data.data||t.data).map(e=>({...e,source:"received"})),i=[...s,...a];i.sort((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime()),this.recentDocuments=i}catch(e){console.error("Erreur lors de la rÃ©cupÃ©ration des documents rÃ©cents:",e.message),this.recentDocuments=[]}finally{this.isLoading=!1}},clearSearch(){clearTimeout(this.searchTimeout),this.searchQuery="",this.$nextTick(()=>{this.$refs.datatable&&this.$refs.datatable.fetchData&&this.$refs.datatable.fetchData()})},refreshData(){this.fetchRecentDocuments()},showLine(e){const t=e.nom.split(".").pop().toLowerCase(),s=["png","jpg","jpeg","gif","webp"].includes(t),a=s?"70vw":"50vw";this.$dialog.open(C.A,{props:{header:"DÃ©tails du document",style:{width:a},modal:!0,maximizable:!0,closeOnEscape:!0},data:{document:e,table:"recent"}})},updateLines(e){this.lines=e},formatSize(e){if(!e)return"0 Bytes";if(0===e)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB","TB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+s[a]},getFileType(e){if(!e)return"Inconnu";const t=e.split(".").pop().toLowerCase(),s={png:"Image PNG",jpg:"Image JPG",jpeg:"Image JPEG",gif:"Image GIF",pdf:"Document PDF",doc:"Document Word",docx:"Document Word",xls:"Fichier Excel",xlsx:"Fichier Excel",ppt:"PrÃ©sentation PowerPoint",pptx:"PrÃ©sentation PowerPoint",zip:"Archive ZIP",rar:"Archive RAR",txt:"Fichier Texte"};return s[t]||`Fichier ${t.toUpperCase()}`},formatDate(e){if(!e)return"Date inconnue";const t=new Date(e);return t.toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})},getSelection(e){this.selection=e},applyFilters(e){console.log("ðŸ” Filtres appliquÃ©s dans RecentDocumentsView:",e),this.$nextTick(()=>{this.$refs.datatable&&this.$refs.datatable.fetchData&&this.$refs.datatable.fetchData()})},handleGlobalFiltersChange(e){const t=e.detail;console.log("ðŸŒ Filtres globaux reÃ§us dans RecentDocumentsView:",t),this.filters=t,this.applyFilters(t)},addToFavorites(e){console.log("Ajout aux favoris:",e);const t={document_id:e.id};this.apiClient.post("/favoris",t).then(t=>{console.log("Document ajoutÃ© aux favoris:",t.data),e.is_favorite=!0,this.$toast.add({severity:"success",summary:"SuccÃ¨s",detail:"Document ajoutÃ© aux favoris",life:3e3})}).catch(e=>{console.error("Erreur lors de l'ajout aux favoris:",e),console.error("DÃ©tails de l'erreur:",e.response?e.response.data:"Pas de rÃ©ponse"),console.error("Status code:",e.response?e.response.status:"Inconnu");const t=e.response&&e.response.data&&e.response.data.message?e.response.data.message:"Impossible d'ajouter ce document aux favoris";this.$toast.add({severity:"error",summary:"Erreur",detail:t,life:5e3})})}}}),S=s(1241);const T=(0,S.A)(E,[["render",D],["__scopeId","data-v-5764fd7c"]]);var R=T,$=(0,a.pM)({name:"RecentIndex",components:{RecentDocumentsView:R}});const I=(0,S.A)($,[["render",o],["__scopeId","data-v-54a7b85c"]]);var P=I},9069:function(e,t,s){s.d(t,{A:function(){return u}});var a=s(6768),i=s(4232);const r={class:"file-icon-container"},n={key:0,class:"file-extension"};function o(e,t,s,o,c,l){return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("div",{class:(0,i.C4)(["file-icon",e.iconClass])},[e.fileExtension?((0,a.uX)(),(0,a.CE)("span",n,(0,i.v_)(e.fileExtension),1)):(0,a.Q3)("",!0)],2)])}var c=(0,a.pM)({name:"FileIcon",props:{fileName:{type:String,required:!0},fileType:{type:String,default:""}},setup(e){const t=e=>{const t=e.split(".");return t.length>1?t[t.length-1].toLowerCase():""},s=(0,a.EW)(()=>{const s=e.fileType.toLowerCase();if(s.includes("pdf")||s.includes("word")||s.includes("excel")||s.includes("powerpoint")||s.includes("image"))return"";const a=t(e.fileName);return a&&a.length<=4?a:""}),i=(0,a.EW)(()=>{const s=e.fileName.toLowerCase(),a=e.fileType.toLowerCase(),i=t(s);return a.includes("image")||["jpg","jpeg","png","gif","webp"].includes(i)?"image-icon":a.includes("pdf")||"pdf"===i?"pdf-icon":a.includes("word")||["doc","docx"].includes(i)?"word-icon":a.includes("excel")||["xls","xlsx","csv"].includes(i)?"excel-icon":a.includes("powerpoint")||["ppt","pptx"].includes(i)?"powerpoint-icon":a.includes("zip")||["zip","rar","7z"].includes(i)?"zip-icon":a.includes("folder")||a.includes("directory")?"folder-icon":a.includes("text")||["txt","md"].includes(i)?"text-icon":"generic-icon"});return{iconClass:i,fileExtension:s}}}),l=s(1241);const d=(0,l.A)(c,[["render",o],["__scopeId","data-v-febcd1ec"]]);var u=d}}]);
//# sourceMappingURL=153.212e0283.js.map