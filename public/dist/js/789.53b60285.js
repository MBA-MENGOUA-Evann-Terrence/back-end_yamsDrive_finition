"use strict";(self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]=self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]||[]).push([[789],{8789:function(e,o,t){t.r(o),t.d(o,{default:function(){return M}});var s=t(6768),r=t(4232),a=t(5130);const n={class:"shared-document-container"},i={key:0,class:"loading-state"},c={key:1,class:"error-state"},d={class:"code-modal"},l={key:0,class:"error-message"},u={class:"modal-actions"},p=["disabled"],m={key:3,class:"document-view"},h={class:"document-header"},g={class:"document-info"},f={class:"document-meta"},v={key:0},k={class:"document-actions"},C={class:"document-content"},w={key:0,class:"image-preview"},b=["src","alt"],L={key:1,class:"pdf-preview"},_=["src"],y={key:2,class:"video-preview"},E=["src"],U={key:3,class:"file-info"},D={key:0};function q(e,o,t,q,A,R){const $=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",n,[A.loading?((0,s.uX)(),(0,s.CE)("div",i,o[7]||(o[7]=[(0,s.Lk)("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"3rem",color:"#4285F4"}},null,-1),(0,s.Lk)("p",null,"Chargement du document partag√©...",-1)]))):A.error?((0,s.uX)(),(0,s.CE)("div",c,[o[9]||(o[9]=(0,s.Lk)("i",{class:"pi pi-exclamation-circle",style:{"font-size":"3rem",color:"#f44336"}},null,-1)),(0,s.Lk)("h2",null,(0,r.v_)(A.error),1),o[10]||(o[10]=(0,s.Lk)("p",null,"Le lien de partage est peut-√™tre expir√© ou invalide.",-1)),(0,s.bF)($,{to:"/connexion",class:"btn btn-primary"},{default:(0,s.k6)(()=>o[8]||(o[8]=[(0,s.Lk)("i",{class:"pi pi-sign-in"},null,-1),(0,s.eW)(" Se connecter ",-1)])),_:1,__:[8]})])):(0,s.Q3)("",!0),A.showCodeModal?((0,s.uX)(),(0,s.CE)("div",{key:2,class:"code-modal-overlay",onClick:o[4]||(o[4]=(0,a.D$)(e=>A.showCodeModal=!1,["self"]))},[(0,s.Lk)("div",d,[o[13]||(o[13]=(0,s.Lk)("h3",null,"Code d'acc√®s requis",-1)),o[14]||(o[14]=(0,s.Lk)("p",null,"Ce document est prot√©g√© par un code √† 6 chiffres.",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>A.accessCode=e),type:"text",maxlength:"6",placeholder:"Entrez le code √† 6 chiffres",class:"code-input",onKeyup:o[1]||(o[1]=(0,a.jR)((...e)=>R.submitAccessCode&&R.submitAccessCode(...e),["enter"]))},null,544),[[a.Jo,A.accessCode]]),A.codeError?((0,s.uX)(),(0,s.CE)("p",l,(0,r.v_)(A.codeError),1)):(0,s.Q3)("",!0),(0,s.Lk)("div",u,[(0,s.Lk)("button",{onClick:o[2]||(o[2]=(...e)=>R.submitAccessCode&&R.submitAccessCode(...e)),class:"btn btn-primary",disabled:6!==A.accessCode.length},o[11]||(o[11]=[(0,s.Lk)("i",{class:"pi pi-check"},null,-1),(0,s.eW)(" Valider ",-1)]),8,p),(0,s.Lk)("button",{onClick:o[3]||(o[3]=e=>A.showCodeModal=!1),class:"btn btn-secondary"},o[12]||(o[12]=[(0,s.Lk)("i",{class:"pi pi-times"},null,-1),(0,s.eW)(" Annuler ",-1)]))])])])):A.document?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.Lk)("div",h,[(0,s.Lk)("div",g,[(0,s.Lk)("i",{class:(0,r.C4)([R.getFileIcon(A.document.nom),"file-icon"])},null,2),(0,s.Lk)("div",null,[(0,s.Lk)("h1",null,(0,r.v_)(A.document.nom),1),(0,s.Lk)("p",f,[o[15]||(o[15]=(0,s.eW)(" Partag√© par ",-1)),(0,s.Lk)("strong",null,(0,r.v_)(A.document.owner?.name||"Utilisateur"),1),A.document.created_at?((0,s.uX)(),(0,s.CE)("span",v," ‚Ä¢ "+(0,r.v_)(R.formatDate(A.document.created_at)),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",k,[(0,s.Lk)("button",{onClick:o[5]||(o[5]=(...e)=>R.downloadDocument&&R.downloadDocument(...e)),class:"btn btn-primary"},o[16]||(o[16]=[(0,s.Lk)("i",{class:"pi pi-download"},null,-1),(0,s.eW)(" T√©l√©charger ",-1)]))])]),(0,s.Lk)("div",C,[R.isImage(A.document.nom)?((0,s.uX)(),(0,s.CE)("div",w,[(0,s.Lk)("img",{src:R.documentUrl,alt:A.document.nom},null,8,b)])):R.isPDF(A.document.nom)?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("iframe",{src:R.documentUrl,frameborder:"0"},null,8,_)])):R.isVideo(A.document.nom)?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("video",{controls:"",src:R.documentUrl},null,8,E)])):((0,s.uX)(),(0,s.CE)("div",U,[(0,s.Lk)("i",{class:(0,r.C4)(R.getFileIcon(A.document.nom)),style:{"font-size":"5rem",color:"#4285F4"}},null,2),(0,s.Lk)("h3",null,(0,r.v_)(A.document.nom),1),(0,s.Lk)("p",null,"Type: "+(0,r.v_)(R.getFileType(A.document.nom)),1),A.document.taille?((0,s.uX)(),(0,s.CE)("p",D,"Taille: "+(0,r.v_)(R.formatFileSize(A.document.taille)),1)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:o[6]||(o[6]=(...e)=>R.downloadDocument&&R.downloadDocument(...e)),class:"btn btn-primary btn-lg mt-3"},o[17]||(o[17]=[(0,s.Lk)("i",{class:"pi pi-download"},null,-1),(0,s.eW)(" T√©l√©charger le fichier ",-1)]))]))])])):(0,s.Q3)("",!0)])}t(4114),t(4603),t(7566),t(8721);var A=t(4373),R={name:"SharedDocumentView",data(){return{document:null,loading:!0,error:null,token:null,showCodeModal:!1,accessCode:"",codeError:"",previewBlobUrl:null}},computed:{documentUrl(){return this.document&&this.previewBlobUrl||""}},mounted(){this.token=this.$route.params.token,this.fetchSharedDocument()},methods:{async fetchSharedDocument(){this.loading=!0,this.error=null;try{console.log("R√©cup√©ration du document avec token:",this.token);const e=await A.A.get(`http://localhost:8000/api/shared-documents/${this.token}/info`);if(console.log("üì• R√©ponse API compl√®te:",e.data),console.log("üìã Structure de response.data.data:",e.data.data),e.data.data&&e.data.data.document){this.document=e.data.data.document,this.document.owner={name:e.data.data.shared_by},console.log("üìÑ Document charg√©:",this.document);const o=e.data.data.require_code||e.data.require_code||!1,t=e.data.data.require_login||e.data.require_login||!1;if(console.log("üîí Restrictions de s√©curit√© d√©tect√©es:",{requireCode:o,requireLogin:t,"depuis data.data":{require_code:e.data.data.require_code,require_login:e.data.data.require_login},"depuis data":{require_code:e.data.require_code,require_login:e.data.require_login}}),o)return this.showCodeModal=!0,void(this.loading=!1);if(t){const e=localStorage.getItem("yamsdigital_session");if(!e)return void this.$router.push({path:"/connexion",query:{redirect:this.$route.fullPath}})}await this.loadDocumentPreview()}else this.error=e.data.message||"Document non trouv√©"}catch(e){if(console.error("Erreur compl√®te:",e),console.error("R√©ponse erreur:",e.response),401===e.response?.status)return void this.$router.push({path:"/connexion",query:{redirect:this.$route.fullPath}});if(404===e.response?.status)this.error="Document non trouv√©";else if(403===e.response?.status){const o=e.response?.data;if(o&&o.require_code)return this.showCodeModal=!0,void(this.loading=!1);this.error="Acc√®s refus√©"}else 410===e.response?.status?this.error="Le lien de partage a expir√©":e.response?this.error=e.response?.data?.message||"Erreur lors du chargement du document":this.error="Impossible de contacter le serveur. V√©rifiez que le backend est d√©marr√©."}finally{this.loading=!1}},async loadDocumentPreview(){try{console.log("Chargement de la pr√©visualisation du document...");let e=`http://localhost:8000/api/shared-documents/${this.token}`;const o={};if(this.accessCode){const t=parseInt(this.accessCode,10);e+=`?access_code=${t}`,o["X-Access-Code"]=this.accessCode}const t=await A.A.get(e,{responseType:"blob",headers:o});this.previewBlobUrl=window.URL.createObjectURL(t.data),console.log("Pr√©visualisation charg√©e avec succ√®s")}catch(e){console.error("Erreur lors du chargement de la pr√©visualisation:",e),403===e.response?.status&&e.response?.data?.require_code&&(this.showCodeModal=!0)}},async submitAccessCode(){if(6===this.accessCode.length){this.codeError="",this.loading=!0,this.showCodeModal=!1,console.log("üîë Envoi du code d'acc√®s:",this.accessCode);try{const e=parseInt(this.accessCode,10);console.log("üì• R√©cup√©ration des informations du document avec le code..."),console.log("üîë Code envoy√©:",this.accessCode,"(nombre:",e,")"),console.log("üìç URL appel√©e:",`http://localhost:8000/api/shared-documents/${this.token}/info?access_code=${e}`);const o=await A.A.get(`http://localhost:8000/api/shared-documents/${this.token}/info?access_code=${e}`,{headers:{"X-Access-Code":this.accessCode}});console.log("üì• R√©ponse /info avec code:",o.data),o.data.data&&o.data.data.document&&(this.document=o.data.data.document,this.document.owner={name:o.data.data.shared_by},console.log("‚úÖ Informations du document r√©cup√©r√©es")),console.log("üì• Chargement du fichier pour pr√©visualisation...");const t=`http://localhost:8000/api/shared-documents/${this.token}?access_code=${e}`,s=await A.A.get(t,{responseType:"blob",headers:{"X-Access-Code":this.accessCode}});console.log("‚úÖ Fichier re√ßu, status:",s.status),200===s.status?(this.previewBlobUrl=window.URL.createObjectURL(s.data),console.log("‚úÖ Document d√©verrouill√© avec le code, pr√©visualisation charg√©e")):this.error="Document non trouv√© ou code incorrect"}catch(e){if(console.error("‚ùå Erreur avec code d'acc√®s:",e),console.error("üìã D√©tails de l'erreur:",e.response?.data),console.error("üî¥ Status HTTP:",e.response?.status),console.error("üî¥ Message:",e.response?.data?.message),403===e.response?.status){const o=e.response?.data?.message||"Code incorrect";console.error("üö´ Acc√®s refus√©:",o),e.response?.data?.require_code?this.codeError="Le code n'a pas √©t√© valid√© par le serveur. V√©rifiez que le code est correct.":this.codeError=o,this.showCodeModal=!0}else this.error=e.response?.data?.message||"Erreur lors du chargement du document"}finally{this.loading=!1}}else this.codeError="Le code doit contenir exactement 6 chiffres"},async downloadDocument(){try{let e=`http://localhost:8000/api/shared-documents/${this.token}`;const o={};if(this.accessCode){const t=parseInt(this.accessCode,10);e+=`?access_code=${t}`,o["X-Access-Code"]=this.accessCode}const t=await A.A.get(e,{responseType:"blob",headers:o}),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download",this.document.nom),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(s)}catch(e){console.error("Erreur lors du t√©l√©chargement:",e),alert("Erreur lors du t√©l√©chargement du fichier")}},isImage(e){const o=e.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","bmp","webp","svg"].includes(o)},isPDF(e){return e.toLowerCase().endsWith(".pdf")},isVideo(e){const o=e.split(".").pop().toLowerCase();return["mp4","webm","ogg","mov"].includes(o)},getFileIcon(e){const o=e.split(".").pop().toLowerCase(),t={pdf:"pi pi-file-pdf",doc:"pi pi-file-word",docx:"pi pi-file-word",xls:"pi pi-file-excel",xlsx:"pi pi-file-excel",ppt:"pi pi-file",pptx:"pi pi-file",jpg:"pi pi-image",jpeg:"pi pi-image",png:"pi pi-image",gif:"pi pi-image",mp4:"pi pi-video",mp3:"pi pi-volume-up",zip:"pi pi-file",rar:"pi pi-file"};return t[o]||"pi pi-file"},getFileType(e){const o=e.split(".").pop().toUpperCase();return o},formatFileSize(e){if(!e)return"N/A";const o=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+o[t]},formatDate(e){if(!e)return"";const o=new Date(e);return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"long",year:"numeric"}).format(o)}},beforeUnmount(){this.previewBlobUrl&&window.URL.revokeObjectURL(this.previewBlobUrl)}},$=t(1241);const x=(0,$.A)(R,[["render",q],["__scopeId","data-v-3d0658ba"]]);var M=x}}]);
//# sourceMappingURL=789.53b60285.js.map