"use strict";(self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]=self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]||[]).push([[761],{4504:function(e,t,s){s.r(t),s.d(t,{default:function(){return M}});var n=s(6768),o=s(4232);const l={class:"document-view-container"},i={class:"view-header"},c={class:"header-actions"},a={class:"card document-management-card"},r={class:"card-body"},u={class:"table-responsive"},d={class:"text-muted mb-2"},p={class:"table table-hover"},h=["onClick"],m={class:"file-cell"},f={class:"ms-2"},g={class:"badge bg-secondary"},v={key:0},D={key:1,class:"text-muted"},k={key:2,class:"text-muted"},w={class:"badge bg-light text-dark"},b={key:0};function y(e,t,s,y,E,C){const L=(0,n.g2)("FileIcon");return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",i,[t[5]||(t[5]=(0,n.Lk)("h1",{class:"view-title"},"Gestion des Documents",-1)),(0,n.Lk)("div",c,[e.hasActiveFilters?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-warning me-2",onClick:t[0]||(t[0]=(...t)=>e.clearFilters&&e.clearFilters(...t))},t[3]||(t[3]=[(0,n.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,n.eW)(" RÃ©initialiser les filtres ",-1)]))):(0,n.Q3)("",!0),(0,n.Lk)("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...t)=>e.showCreateModal&&e.showCreateModal(...t))},t[4]||(t[4]=[(0,n.Lk)("i",{class:"fas fa-plus me-1"},null,-1),(0,n.eW)(" Nouveau Document ",-1)])),(0,n.Lk)("button",{id:"refreshdocuments",onClick:t[2]||(t[2]=(...t)=>e.refreshData&&e.refreshData(...t)),class:"d-none"},"RafraÃ®chir")])]),(0,n.Lk)("div",a,[(0,n.Lk)("div",r,[(0,n.Lk)("div",u,[(0,n.Lk)("p",d,"ðŸ“Š Nombre de documents: "+(0,o.v_)(e.documents.length),1),(0,n.Lk)("table",p,[t[7]||(t[7]=(0,n.Lk)("thead",{class:"table-light"},[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Fichier"),(0,n.Lk)("th",null,"Type"),(0,n.Lk)("th",null,"Taille"),(0,n.Lk)("th",null,"Service"),(0,n.Lk)("th",null,"AjoutÃ© le")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.documents,t=>((0,n.uX)(),(0,n.CE)("tr",{key:t.id,onClick:s=>e.showLine(t),style:{cursor:"pointer"}},[(0,n.Lk)("td",null,[(0,n.Lk)("div",m,[(0,n.bF)(L,{fileName:t.nom},null,8,["fileName"]),(0,n.Lk)("span",f,(0,o.v_)(t.nom),1)])]),(0,n.Lk)("td",null,[(0,n.Lk)("span",g,(0,o.v_)(e.getFileType(t.nom)),1)]),(0,n.Lk)("td",null,(0,o.v_)(e.formatSize(t.taille)),1),(0,n.Lk)("td",null,[t.service?((0,n.uX)(),(0,n.CE)("span",v,(0,o.v_)(t.service.nom),1)):t.service_id?((0,n.uX)(),(0,n.CE)("span",D,"Service #"+(0,o.v_)(t.service_id),1)):((0,n.uX)(),(0,n.CE)("span",k,"Aucun service"))]),(0,n.Lk)("td",null,[(0,n.Lk)("span",w,(0,o.v_)(new Date(t.created_at).toLocaleDateString()),1)])],8,h))),128)),0===e.documents.length?((0,n.uX)(),(0,n.CE)("tr",b,t[6]||(t[6]=[(0,n.Lk)("td",{colspan:"6",class:"text-center text-muted py-4"}," Aucun document trouvÃ© ",-1)]))):(0,n.Q3)("",!0)])])])])])])}s(8111),s(2489),s(3579);var E=s(2576),C=s(139),L=s(9069),x=s(1526),_=s(1804),T=(0,n.pM)({name:"DocumentsView",components:{FileIcon:L.A},data(){return{apiClient:x.A,documents:[],allDocuments:[],filters:{},lines:0,selection:[],columns:[{key:"nom",label:"Fichier"},{key:"type_lisible",label:"Type"},{key:"taille",label:"Taille"},{key:"service",label:"Service"},{key:"created_at",label:"AjoutÃ© le"}]}},computed:{hasActiveFilters(){return this.filters&&(this.filters.type||this.filters.person||this.filters.service)}},methods:{clearFilters(){console.log("ðŸ§¹ RÃ©initialisation des filtres"),this.filters={},localStorage.removeItem("globalFilters"),this.documents=[...this.allDocuments],console.log("âœ… Tous les documents affichÃ©s:",this.documents.length),window.dispatchEvent(new CustomEvent("global-filters-change",{detail:{}}))},async fetchDocuments(){try{console.log("ðŸ”„ fetchDocuments: dÃ©but");const e=await this.apiClient.get("/documents?per_page=1000");console.log("ðŸ“¥ Response reÃ§ue:",e.data),console.log("ðŸ“¥ Type de response.data:",typeof e.data),console.log("ðŸ“¥ response.data.data existe?",e.data?.data);let t=[];e.data&&Array.isArray(e.data.data)?(t=e.data.data,console.log("âœ… Documents trouvÃ©s (data.data):",t.length,"Ã©lÃ©ments")):Array.isArray(e.data)?(t=e.data,console.log("âœ… Documents trouvÃ©s (racine):",t.length,"Ã©lÃ©ments")):(console.error("âš ï¸ Structure inattendue:",e.data),t=[]),console.log("ðŸ“‹ Documents finaux Ã  afficher:",t.length),this.allDocuments=t,this.documents=t,console.log("âœ… this.documents mis Ã  jour:",this.documents.length),console.log("ðŸ” Filtres actifs:",this.filters),Object.keys(this.filters).some(e=>this.filters[e])?(console.log("âš ï¸ Application des filtres..."),this.applyFilters(this.filters),console.log("ðŸ“Š Documents aprÃ¨s filtrage:",this.documents.length)):console.log("âœ… Aucun filtre actif"),this.$nextTick(()=>{console.log("ðŸ”„ Force update aprÃ¨s nextTick"),this.$forceUpdate()})}catch(e){console.error("âŒ Erreur lors de la rÃ©cupÃ©ration des documents:",e),this.documents=[],this.allDocuments=[]}},async refreshData(){console.log("DocumentsView: refreshData appelÃ©"),await this.fetchDocuments()},showLine(e){const t=e.nom.split(".").pop().toLowerCase(),s=["png","jpg","jpeg","gif","webp"].includes(t),n=s?"70vw":"50vw";this.$dialog.open(C.A,{props:{header:"DÃ©tails du document",style:{width:n},modal:!0,maximizable:!0,closeOnEscape:!0},data:{document:e}})},updateLines(e){this.lines=e},getSelection(e){this.selection=e},showCreateModal(){this.$dialog.open(E.A,{props:{header:"Ajouter un document",style:{width:"50vw"},modal:!0},onClose:()=>{console.log("ðŸ”” Modal fermÃ© - RafraÃ®chissement automatique"),setTimeout(()=>{this.fetchDocuments()},200)}})},refreshTable(){console.log("ðŸ”„ RafraÃ®chissement du tableau des documents..."),this.fetchDocuments()},applyFilters(e){console.log("ðŸ” Filtres appliquÃ©s dans DocumentsView:",e);const t=e&&(e.type||e.person||e.service);t?(this.documents=this.allDocuments.filter(t=>{if(e.type){const s=this.getDocumentType(t.nom);if(s!==e.type)return!1}return(!e.person||t.user_id===e.person)&&(!e.service||t.service_id===e.service)}),console.log(`âœ… ${this.documents.length} document(s) aprÃ¨s filtrage`)):this.documents=[...this.allDocuments]},getDocumentType(e){if(!e)return"other";const t=e.split(".").pop().toLowerCase();return"pdf"===t?"pdf":["jpg","jpeg","png","gif","webp","bmp","svg"].includes(t)?"image":["doc","docx"].includes(t)?"word":["xls","xlsx"].includes(t)?"excel":["ppt","pptx"].includes(t)?"powerpoint":["zip","rar","7z","tar","gz"].includes(t)?"archive":"txt"===t?"text":"other"},formatSize(e){if(!e)return"0 Bytes";if(0===e)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+s[n]},getFileType(e){if(!e)return"Inconnu";const t=e.split(".").pop().toLowerCase(),s={png:"Image PNG",jpg:"Image JPG",jpeg:"Image JPEG",gif:"Image GIF",pdf:"Document PDF",doc:"Document Word",docx:"Document Word",xls:"Fichier Excel",xlsx:"Fichier Excel",ppt:"PrÃ©sentation PowerPoint",pptx:"PrÃ©sentation PowerPoint",zip:"Archive ZIP",rar:"Archive RAR",txt:"Fichier Texte"};return s[t]||`Fichier ${t.toUpperCase()}`},handleGlobalFiltersChange(e){const t=e.detail;console.log("ðŸŒ DocumentsView a reÃ§u les filtres globaux:",t),this.filters=t,this.applyFilters(t)}},mounted(){this.fetchDocuments(),console.log("ðŸ‘‚ DocumentsView: Ã‰coute des Ã©vÃ©nements de documents"),_.B.on(_.q.DOCUMENT_CREATED,()=>{console.log("ðŸ“¢ DocumentsView: Ã‰vÃ©nement DOCUMENT_CREATED reÃ§u"),this.fetchDocuments()}),_.B.on(_.q.DOCUMENT_UPDATED,()=>{console.log("ðŸ“¢ DocumentsView: Ã‰vÃ©nement DOCUMENT_UPDATED reÃ§u"),this.fetchDocuments()}),_.B.on(_.q.DOCUMENT_DELETED,()=>{console.log("ðŸ“¢ DocumentsView: Ã‰vÃ©nement DOCUMENT_DELETED reÃ§u"),this.fetchDocuments()}),window.addEventListener("global-filters-change",this.handleGlobalFiltersChange);try{const e=localStorage.getItem("globalFilters");e&&(this.filters=JSON.parse(e))}catch(e){console.error("Erreur lors de la restauration des filtres:",e)}},beforeUnmount(){_.B.off(_.q.DOCUMENT_CREATED,this.fetchDocuments),_.B.off(_.q.DOCUMENT_UPDATED,this.fetchDocuments),_.B.off(_.q.DOCUMENT_DELETED,this.fetchDocuments),window.removeEventListener("global-filters-change",this.handleGlobalFiltersChange)},unmounted(){this.unsubscribe&&this.unsubscribe()}}),F=s(1241);const A=(0,F.A)(T,[["render",y],["__scopeId","data-v-dfef3f9e"]]);var M=A},9069:function(e,t,s){s.d(t,{A:function(){return d}});var n=s(6768),o=s(4232);const l={class:"file-icon-container"},i={key:0,class:"file-extension"};function c(e,t,s,c,a,r){return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",{class:(0,o.C4)(["file-icon",e.iconClass])},[e.fileExtension?((0,n.uX)(),(0,n.CE)("span",i,(0,o.v_)(e.fileExtension),1)):(0,n.Q3)("",!0)],2)])}var a=(0,n.pM)({name:"FileIcon",props:{fileName:{type:String,required:!0},fileType:{type:String,default:""}},setup(e){const t=e=>{const t=e.split(".");return t.length>1?t[t.length-1].toLowerCase():""},s=(0,n.EW)(()=>{const s=e.fileType.toLowerCase();if(s.includes("pdf")||s.includes("word")||s.includes("excel")||s.includes("powerpoint")||s.includes("image"))return"";const n=t(e.fileName);return n&&n.length<=4?n:""}),o=(0,n.EW)(()=>{const s=e.fileName.toLowerCase(),n=e.fileType.toLowerCase(),o=t(s);return n.includes("image")||["jpg","jpeg","png","gif","webp"].includes(o)?"image-icon":n.includes("pdf")||"pdf"===o?"pdf-icon":n.includes("word")||["doc","docx"].includes(o)?"word-icon":n.includes("excel")||["xls","xlsx","csv"].includes(o)?"excel-icon":n.includes("powerpoint")||["ppt","pptx"].includes(o)?"powerpoint-icon":n.includes("zip")||["zip","rar","7z"].includes(o)?"zip-icon":n.includes("folder")||n.includes("directory")?"folder-icon":n.includes("text")||["txt","md"].includes(o)?"text-icon":"generic-icon"});return{iconClass:o,fileExtension:s}}}),r=s(1241);const u=(0,r.A)(a,[["render",c],["__scopeId","data-v-febcd1ec"]]);var d=u}}]);
//# sourceMappingURL=761.e770d0ba.js.map