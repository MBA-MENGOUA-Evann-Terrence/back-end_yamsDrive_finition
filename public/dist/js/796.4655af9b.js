"use strict";(self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]=self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]||[]).push([[796],{7796:function(e,s,r){r.r(s),r.d(s,{default:function(){return me}});var t=r(6768),a=r(4232);const i={class:"card service-management-card"},o={class:"card-header"},l={class:"card-body"},d={key:0},n={key:1,class:"text-muted"},c={class:"p-2 rounded badge badge-secondary"};function u(e,s,r,u,m,p){const h=(0,t.g2)("AsdecodeTable");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.Lk)("div",o,[s[2]||(s[2]=(0,t.Lk)("h1",{class:"card-title"},"Gestion des utilisateurs",-1)),(0,t.Lk)("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=(...s)=>e.showCreateModal&&e.showCreateModal(...s))},s[1]||(s[1]=[(0,t.Lk)("i",{class:"fas fa-plus me-1"},null,-1),(0,t.eW)(" Ajouter un utilisateur ",-1)]))]),(0,t.Lk)("div",l,[((0,t.uX)(),(0,t.Wv)(h,{ref:"userTable",key:e.tableKey,columns:e.columns,url:"/api/users",table:"users",onSetTotalRecords:e.updateLines,onRowClick:e.showLine,onSetSelectedRows:e.getSelection,"show-top-stats":!1,"show-bottom-stats":!1},{service:(0,t.k6)(e=>[e.data.service?((0,t.uX)(),(0,t.CE)("span",d,(0,a.v_)(e.data.service.nom),1)):((0,t.uX)(),(0,t.CE)("span",n,"N/A"))]),created_at:(0,t.k6)(e=>[(0,t.Lk)("span",c,(0,a.v_)(e.data.created_at),1)]),_:1},8,["columns","onSetTotalRecords","onRowClick","onSetSelectedRows"]))])])}r(6587);var m=r(5130);const p={class:"field mb-3"},h={class:"field mb-3"},f={class:"field mb-3"},v={class:"d-flex justify-content-end mt-4"};function g(e,s,r,a,i,o){const l=(0,t.g2)("InputText"),d=(0,t.g2)("Button");return(0,t.uX)(),(0,t.CE)("form",{onSubmit:s[4]||(s[4]=(0,m.D$)((...s)=>e.submitForm&&e.submitForm(...s),["prevent"])),class:"p-fluid"},[(0,t.Lk)("div",p,[s[5]||(s[5]=(0,t.Lk)("label",{for:"nom"},"Nom",-1)),(0,t.bF)(l,{id:"nom",modelValue:e.form.nom,"onUpdate:modelValue":s[0]||(s[0]=s=>e.form.nom=s),required:""},null,8,["modelValue"])]),(0,t.Lk)("div",h,[s[6]||(s[6]=(0,t.Lk)("label",{for:"prenom"},"Prénom",-1)),(0,t.bF)(l,{id:"prenom",modelValue:e.form.prenom,"onUpdate:modelValue":s[1]||(s[1]=s=>e.form.prenom=s),required:""},null,8,["modelValue"])]),(0,t.Lk)("div",f,[s[7]||(s[7]=(0,t.Lk)("label",{for:"email"},"Email",-1)),(0,t.bF)(l,{id:"email",modelValue:e.form.email,"onUpdate:modelValue":s[2]||(s[2]=s=>e.form.email=s),type:"email",required:""},null,8,["modelValue"])]),(0,t.Lk)("div",v,[(0,t.bF)(d,{label:"Annuler",icon:"pi pi-times",onClick:s[3]||(s[3]=s=>e.dialogRef.close()),class:"p-button-text"}),(0,t.bF)(d,{type:"submit",label:e.isEditMode?"Mettre à jour":"Enregistrer",icon:"pi pi-check",loading:e.isLoading},null,8,["label","loading"])])],32)}r(8111),r(7588);var b=r(2151),w=r(4592),k=r(2775),y=(0,t.pM)({name:"FormuseurView",components:{InputText:w.A,Button:k.A},inject:["dialogRef"],setup(){const e=(0,b.d)();return{toast:e}},data(){return{isLoading:!1,form:{id:null,nom:"",prenom:"",email:""}}},computed:{isEditMode(){return!!(this.dialogRef&&this.dialogRef.data&&this.dialogRef.data.id)}},mounted(){this.isEditMode&&(this.form={...this.dialogRef.data})},methods:{async submitForm(){this.isLoading=!0;try{const e={nom:this.form.nom.trim(),prenom:this.form.prenom.trim(),email:this.form.email.trim().toLowerCase()};let s;s=this.isEditMode?await this.axios.put(`/api/users/${this.form.id}`,e):await this.axios.post("/api/utilisateurs/new",e),s.data.success||[200,201].includes(s.status)?this.handleSuccess(s.data.message||"Opération réussie"):this.handleError(s.data.errors)}catch(e){const s=e.response?.data?.message||`Erreur lors de la ${this.isEditMode?"modification":"création"}.`;this.toast.add({severity:"error",summary:"Erreur",detail:s,life:5e3})}finally{this.isLoading=!1}},handleSuccess(e){this.toast.add({severity:"success",summary:"Succès",detail:e,life:3e3}),this.dialogRef.close({success:!0})},handleError(e){const s=e||["Une erreur est survenue"];s.forEach(e=>{this.toast.add({severity:"error",summary:"Erreur de validation",detail:e,life:5e3})})}}}),L=r(1241);const C=(0,L.A)(y,[["render",g],["__scopeId","data-v-d3e566fc"]]);var E=C;const R={class:"user-details"},S={class:"user-info mb-4"},_={class:"row mb-3"},$={class:"col-md-8"},V={class:"row mb-3"},P={class:"col-md-8"},A={class:"row mb-3"},D={class:"col-md-8"},U={class:"d-flex align-items-center gap-2"},F={class:"row mb-3"},M={class:"col-md-8"},x={class:"d-flex align-items-center gap-2"},z={class:"row mb-3"},T={class:"col-md-8"},j={class:"row mb-3"},X={class:"col-md-8"},I={class:"action-buttons d-flex justify-content-end gap-2"},W={class:"p-fluid"},q={class:"field mb-3"},N={key:0,class:"p-error"},B={class:"field mb-3"};function O(e,s,r,i,o,l){const d=(0,t.g2)("Dropdown"),n=(0,t.g2)("Button"),c=(0,t.g2)("Password"),u=(0,t.g2)("Dialog");return(0,t.uX)(),(0,t.CE)("div",R,[(0,t.Lk)("div",S,[(0,t.Lk)("div",_,[s[6]||(s[6]=(0,t.Lk)("div",{class:"col-md-4 fw-bold"},"Nom:",-1)),(0,t.Lk)("div",$,(0,a.v_)(o.user.name),1)]),(0,t.Lk)("div",V,[s[7]||(s[7]=(0,t.Lk)("div",{class:"col-md-4 fw-bold"},"Email:",-1)),(0,t.Lk)("div",P,(0,a.v_)(o.user.email),1)]),(0,t.Lk)("div",A,[s[8]||(s[8]=(0,t.Lk)("div",{class:"col-md-4 fw-bold"},"Rôle:",-1)),(0,t.Lk)("div",D,[(0,t.Lk)("div",U,[(0,t.Lk)("span",{class:(0,a.C4)(["badge",l.roleClass])},(0,a.v_)(l.roleLabel),3),(0,t.bF)(d,{modelValue:o.selectedRole,"onUpdate:modelValue":s[0]||(s[0]=e=>o.selectedRole=e),options:o.roles,optionLabel:"label",optionValue:"value",placeholder:"Changer le rôle",class:"w-auto",onChange:l.assignRole},null,8,["modelValue","options","onChange"])])])]),(0,t.Lk)("div",F,[s[9]||(s[9]=(0,t.Lk)("div",{class:"col-md-4 fw-bold"},"Service:",-1)),(0,t.Lk)("div",M,[(0,t.Lk)("div",x,[(0,t.Lk)("span",null,(0,a.v_)(o.user.service?o.user.service.nom:"N/A"),1),(0,t.bF)(d,{modelValue:o.selectedService,"onUpdate:modelValue":s[1]||(s[1]=e=>o.selectedService=e),options:o.services,optionLabel:"nom",optionValue:"id",placeholder:"Changer le service",class:"w-auto",onChange:l.assignService,loading:o.loadingServices},null,8,["modelValue","options","onChange","loading"])])])]),(0,t.Lk)("div",z,[s[10]||(s[10]=(0,t.Lk)("div",{class:"col-md-4 fw-bold"},"Statut du compte:",-1)),(0,t.Lk)("div",T,[(0,t.Lk)("span",{class:(0,a.C4)(["badge",l.statusClass])},(0,a.v_)(l.statusLabel),3)])]),(0,t.Lk)("div",j,[s[11]||(s[11]=(0,t.Lk)("div",{class:"col-md-4 fw-bold"},"Inscrit le:",-1)),(0,t.Lk)("div",X,(0,a.v_)(l.formatDate(o.user.created_at)),1)])]),(0,t.Lk)("div",I,[(0,t.bF)(n,{label:"Réinitialiser le mot de passe",icon:"pi pi-key",class:"p-button-info",onClick:l.showPasswordResetDialog},null,8,["onClick"]),o.user.is_frozen?((0,t.uX)(),(0,t.Wv)(n,{key:1,label:"Dégeler le compte",icon:"pi pi-unlock",class:"p-button-success",onClick:l.confirmUnfreeze},null,8,["onClick"])):((0,t.uX)(),(0,t.Wv)(n,{key:0,label:"Geler le compte",icon:"pi pi-lock",class:"p-button-warning",onClick:l.confirmFreeze},null,8,["onClick"]))]),(0,t.bF)(u,{visible:o.passwordResetVisible,"onUpdate:visible":s[5]||(s[5]=e=>o.passwordResetVisible=e),header:"Réinitialiser le mot de passe",modal:!0,style:{width:"450px"}},{footer:(0,t.k6)(()=>[(0,t.bF)(n,{label:"Annuler",icon:"pi pi-times",onClick:s[4]||(s[4]=e=>o.passwordResetVisible=!1),class:"p-button-text"}),(0,t.bF)(n,{label:"Réinitialiser",icon:"pi pi-check",onClick:l.resetPassword,loading:o.isResettingPassword},null,8,["onClick","loading"])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",W,[(0,t.Lk)("div",q,[s[12]||(s[12]=(0,t.Lk)("label",{for:"newPassword",class:"fw-bold"},"Nouveau mot de passe",-1)),(0,t.bF)(c,{id:"newPassword",modelValue:o.newPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>o.newPassword=e),feedback:!0,toggleMask:"",placeholder:"Entrez le nouveau mot de passe",class:(0,a.C4)({"p-invalid":o.passwordError})},null,8,["modelValue","class"]),o.passwordError?((0,t.uX)(),(0,t.CE)("small",N,(0,a.v_)(o.passwordError),1)):(0,t.Q3)("",!0)]),(0,t.Lk)("div",B,[s[13]||(s[13]=(0,t.Lk)("label",{for:"confirmPassword",class:"fw-bold"},"Confirmer le mot de passe",-1)),(0,t.bF)(c,{id:"confirmPassword",modelValue:o.confirmPassword,"onUpdate:modelValue":s[3]||(s[3]=e=>o.confirmPassword=e),feedback:!1,toggleMask:"",placeholder:"Confirmez le mot de passe",class:(0,a.C4)({"p-invalid":o.passwordError})},null,8,["modelValue","class"])])])]),_:1},8,["visible"])])}r(116);var K=r(2229),G=r(7674),Q=r(1934),H=r(4373),J={name:"ShowuseurView",components:{Button:k.A,Dropdown:K.A,Dialog:G.A,Password:Q.A},inject:["dialogRef"],data(){return{user:{},table:"users",selectedRole:null,selectedService:null,roles:[{label:"Administrateur",value:"1"},{label:"Utilisateur",value:"0"}],services:[],loadingServices:!1,passwordResetVisible:!1,newPassword:"",confirmPassword:"",passwordError:"",isResettingPassword:!1}},computed:{roleClass(){return"admin"===this.user.role?"bg-danger":"bg-primary"},roleLabel(){return"admin"===this.user.role?"Administrateur":"Utilisateur"},statusClass(){return this.user.is_frozen?"bg-danger":"bg-success"},statusLabel(){return this.user.is_frozen?"Compte gelé":"Compte actif"}},mounted(){this.dialogRef&&this.dialogRef.data&&(this.user={...this.dialogRef.data}),this.fetchServices()},methods:{async fetchServices(){this.loadingServices=!0;try{const e=await H.A.get("/api/services");this.services=e.data.data||e.data}catch(e){console.error("Erreur lors de la récupération des services:",e),this.$toast.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les services",life:3e3})}finally{this.loadingServices=!1}},async assignRole(){if(this.selectedRole)try{await H.A.patch(`/api/users/${this.user.id}/assign-role`,{role:this.selectedRole}),this.$toast.add({severity:"success",summary:"Succès",detail:"Rôle attribué avec succès",life:3e3}),this.user.role="1"===this.selectedRole?"admin":"user",this.selectedRole=null,this.dialogRef.close({success:!0})}catch(e){console.error("Erreur lors de l'attribution du rôle:",e),this.$toast.add({severity:"error",summary:"Erreur",detail:e.response?.data?.message||"L'attribution du rôle a échoué",life:3e3})}},async assignService(){if(this.selectedService)try{await H.A.patch(`/api/users/${this.user.id}/assign-service`,{service_id:this.selectedService}),this.$toast.add({severity:"success",summary:"Succès",detail:"Service attribué avec succès",life:3e3});const e=this.services.find(e=>e.id===this.selectedService);this.user.service=e,this.selectedService=null,this.dialogRef.close({success:!0})}catch(e){console.error("Erreur lors de l'attribution du service:",e),this.$toast.add({severity:"error",summary:"Erreur",detail:e.response?.data?.message||"L'attribution du service a échoué",life:3e3})}},formatDate(e){if(!e)return"";try{const s=new Date(e);return s.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).replace(","," à")}catch(s){return console.error("Erreur de formatage de date:",s),e}},editUser(){this.dialogRef.close(),this.$dialog.open(E,{props:{header:"Modifier l'utilisateur",style:{width:"50vw"},modal:!0},data:this.user})},confirmFreeze(e){this.$confirm.require({target:e.currentTarget,message:`Êtes-vous sûr de vouloir geler le compte de ${this.user.name} ? L'utilisateur ne pourra plus se connecter.`,header:"Confirmation de gel de compte",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-warning",acceptLabel:"Oui, geler",rejectLabel:"Annuler",accept:()=>{this.freezeUser()}})},confirmUnfreeze(e){this.$confirm.require({target:e.currentTarget,message:`Êtes-vous sûr de vouloir dégeler le compte de ${this.user.name} ? L'utilisateur pourra à nouveau se connecter.`,header:"Confirmation de dégel de compte",icon:"pi pi-info-circle",acceptClass:"p-button-success",acceptLabel:"Oui, dégeler",rejectLabel:"Annuler",accept:()=>{this.unfreezeUser()}})},async freezeUser(){try{await H.A.delete(`/api/users/${this.user.id}`),this.$toast.add({severity:"success",summary:"Succès",detail:`Le compte de ${this.user.name} a été gelé`,life:3e3}),this.dialogRef.close({success:!0})}catch(e){console.error("Erreur lors du gel:",e),this.$toast.add({severity:"error",summary:"Erreur",detail:e.response?.data?.message||"Le gel du compte a échoué",life:3e3})}},async unfreezeUser(){try{await H.A.patch(`/api/users/${this.user.id}/unfreeze`),this.$toast.add({severity:"success",summary:"Succès",detail:`Le compte de ${this.user.name} a été dégelé`,life:3e3}),this.dialogRef.close({success:!0})}catch(e){console.error("Erreur lors du dégel:",e),this.$toast.add({severity:"error",summary:"Erreur",detail:e.response?.data?.message||"Le dégel du compte a échoué",life:3e3})}},showPasswordResetDialog(){this.passwordResetVisible=!0,this.newPassword="",this.confirmPassword="",this.passwordError=""},async resetPassword(){if(this.passwordError="",this.newPassword&&this.confirmPassword)if(this.newPassword.length<8)this.passwordError="Le mot de passe doit contenir au moins 8 caractères";else if(this.newPassword===this.confirmPassword){this.isResettingPassword=!0;try{await H.A.patch(`/api/users/${this.user.id}/reset-password`,{password:this.newPassword,password_confirmation:this.confirmPassword}),this.$toast.add({severity:"success",summary:"Succès",detail:`Le mot de passe de ${this.user.name} a été réinitialisé`,life:3e3}),this.passwordResetVisible=!1,this.newPassword="",this.confirmPassword=""}catch(e){console.error("Erreur lors de la réinitialisation:",e),this.passwordError=e.response?.data?.message||"La réinitialisation a échoué",this.$toast.add({severity:"error",summary:"Erreur",detail:this.passwordError,life:3e3})}finally{this.isResettingPassword=!1}}else this.passwordError="Les mots de passe ne correspondent pas";else this.passwordError="Veuillez remplir tous les champs"},handleError(e){const s=e||["Une erreur est survenue"];s.forEach(e=>{this.$toast.add({severity:"error",summary:"Erreur",detail:e,life:7e3})})}}};const Y=(0,L.A)(J,[["render",O],["__scopeId","data-v-21b31dac"]]);var Z=Y;const ee={class:"delete-user-container p-4"},se={class:"confirmation-text"},re={class:"d-flex justify-content-end mt-4"},te=["disabled"],ae={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ie={key:1};function oe(e,s,r,i,o,l){return(0,t.uX)(),(0,t.CE)("div",ee,[(0,t.Lk)("p",se,[s[2]||(s[2]=(0,t.eW)(" Êtes-vous sûr de vouloir supprimer l'utilisateur ",-1)),(0,t.Lk)("strong",null,(0,a.v_)(e.user.name),1),s[3]||(s[3]=(0,t.eW)(" ? ",-1)),s[4]||(s[4]=(0,t.Lk)("br",null,null,-1)),s[5]||(s[5]=(0,t.eW)(" Cette action est irréversible. ",-1))]),(0,t.Lk)("div",re,[(0,t.Lk)("button",{class:"btn btn-secondary me-2",onClick:s[0]||(s[0]=s=>e.closeDialog(!1))},"Annuler"),(0,t.Lk)("button",{class:"btn btn-danger",onClick:s[1]||(s[1]=(...s)=>e.deleteUser&&e.deleteUser(...s)),disabled:e.isDeleting},[e.isDeleting?((0,t.uX)(),(0,t.CE)("span",ae)):((0,t.uX)(),(0,t.CE)("span",ie,"Supprimer"))],8,te)])])}var le=(0,t.pM)({name:"DeleteUserView",props:{user:{type:Object,required:!0}},inject:["dialogRef"],data(){return{isDeleting:!1}},methods:{closeDialog(e=!1){this.dialogRef.close({success:e})},async deleteUser(){this.isDeleting=!0;try{await this.axios.delete(`/api/users/${this.user.id}`),this.$toast.add({severity:"success",summary:"Succès",detail:`L'utilisateur ${this.user.name} a été supprimé.`,life:3e3}),this.closeDialog(!0)}catch(e){this.$toast.add({severity:"error",summary:"Erreur",detail:"La suppression de l'utilisateur a échoué.",life:3e3}),console.error("Erreur lors de la suppression de l'utilisateur:",e),this.isDeleting=!1}}}});const de=(0,L.A)(le,[["render",oe],["__scopeId","data-v-2851ebbd"]]);var ne=de,ce=(r(141),(0,t.pM)({name:"ListeView",data(){return{tableKey:0,lines:0,selection:[],columns:[{key:"id",label:"ID"},{key:"name",label:"Nom"},{key:"email",label:"Email"},{key:"service",label:"Service"},{key:"created_at",label:"Date d'inscription"}]}},methods:{showLine(e){this.$dialog.open(Z,{props:{header:"Détails de l'utilisateur",style:{width:"50vw"},modal:!0},data:e,onClose:e=>{e&&e.data&&e.data.success&&this.refreshTable()}})},updateLines(e){this.lines=e},showEditModal(e){this.$dialog.open(E,{props:{header:"Modifier l'utilisateur",style:{width:"50vw"},modal:!0},data:e,onClose:e=>{e&&e.data&&e.data.success&&this.refreshTable()}})},showCreateModal(){this.$dialog.open(E,{props:{header:"Ajouter un utilisateur",style:{width:"50vw"},modal:!0},onClose:e=>{e&&e.data&&e.data.success&&this.refreshTable()}})},refreshTable(){this.tableKey+=1},getSelection(e){this.selection=e},formatDate(e){if(!e)return"";const s=new Date(e);return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}).format(s)},getRoleSeverity(e){switch(e){case"admin":return"danger";case"editor":return"warning";default:return"info"}},getStatusSeverity(e){switch(e){case"Actif":return"success";case"Inactif":return"secondary";case"En attente":return"warning";default:return"info"}},showDeleteModal(e){this.$dialog.open(ne,{props:{header:"Confirmation de suppression",style:{width:"30vw"},modal:!0},data:{user:e},onClose:e=>{e&&e.data&&e.data.success&&this.refreshTable()}})}}}));const ue=(0,L.A)(ce,[["render",u],["__scopeId","data-v-43361618"]]);var me=ue}}]);
//# sourceMappingURL=796.4655af9b.js.map