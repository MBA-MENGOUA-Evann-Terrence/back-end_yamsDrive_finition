"use strict";(self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]=self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]||[]).push([[834],{5561:function(e,t,s){s.r(t),s.d(t,{default:function(){return j}});var a=s(6768),r=s(4232);const o={class:"document-view-container"},l={class:"view-header"},n={key:0,class:"search-query"},i={class:"card document-management-card"},c={class:"card-body"},d={class:"search-results"},u={key:0,class:"loading-container"},h={key:1,class:"no-results"},p={class:"text-muted"},f={key:2,class:"results-container"},m={class:"results-count mb-3"},g={class:"badge bg-primary"},y={class:"table-responsive"},v={class:"table table-hover"},k=["onClick"],b={class:"file-cell"},L={class:"file-name"},w={class:"badge bg-info"},x={class:"text-muted"};function _(e,t,s,_,C,S){return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",l,[t[1]||(t[1]=(0,a.Lk)("h1",{class:"view-title"},[(0,a.Lk)("i",{class:"fas fa-search me-2"}),(0,a.eW)(" R√©sultats de recherche ")],-1)),e.searchQuery?((0,a.uX)(),(0,a.CE)("p",n,[t[0]||(t[0]=(0,a.eW)(" Recherche pour : ",-1)),(0,a.Lk)("strong",null,'"'+(0,r.v_)(e.searchQuery)+'"',1)])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",i,[(0,a.Lk)("div",c,[(0,a.Lk)("div",d,[e.isLoading?((0,a.uX)(),(0,a.CE)("div",u,t[2]||(t[2]=[(0,a.Lk)("i",{class:"fas fa-spinner fa-spin fa-3x text-primary"},null,-1),(0,a.Lk)("p",{class:"mt-3"},"Recherche en cours...",-1)]))):e.isLoading||0!==e.documents.length?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("div",m,[(0,a.Lk)("span",g,(0,r.v_)(e.documents.length)+" r√©sultat(s) trouv√©(s)",1)]),(0,a.Lk)("div",y,[(0,a.Lk)("table",v,[t[5]||(t[5]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Nom du document"),(0,a.Lk)("th",null,"Service"),(0,a.Lk)("th",null,"Date de cr√©ation")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.documents,t=>((0,a.uX)(),(0,a.CE)("tr",{key:t.id,onClick:s=>e.showDocument(t),class:"cursor-pointer"},[(0,a.Lk)("td",null,[(0,a.Lk)("div",b,[(0,a.Lk)("i",{class:(0,r.C4)([e.getFileIcon(t.nom),"file-icon me-2"])},null,2),(0,a.Lk)("span",L,(0,r.v_)(t.nom),1)])]),(0,a.Lk)("td",null,[(0,a.Lk)("span",w,(0,r.v_)(t.service?.nom||"N/A"),1)]),(0,a.Lk)("td",null,[(0,a.Lk)("span",x,(0,r.v_)(e.formatDate(t.created_at)),1)])],8,k))),128))])])])])):((0,a.uX)(),(0,a.CE)("div",h,[t[3]||(t[3]=(0,a.Lk)("i",{class:"fas fa-search fa-3x text-muted mb-3"},null,-1)),t[4]||(t[4]=(0,a.Lk)("h3",null,"Aucun r√©sultat trouv√©",-1)),(0,a.Lk)("p",p,' Aucun document ne correspond √† votre recherche "'+(0,r.v_)(e.searchQuery)+'" ',1)]))])])])])}s(8111),s(2489),s(3579);var C=s(1387),S=s(5841),A=s(1526),D=s(139),E=(0,a.pM)({name:"GlobalSearchView",components:{},setup(){const e=(0,C.lq)(),t=(0,S.s)();return{route:e,dialog:t}},data(){return{apiClient:A.A,searchQuery:"",isLoading:!1,documents:[],allDocuments:[],filters:{}}},watch:{"route.query.q":{immediate:!0,handler(e){e&&(this.searchQuery=e.toString(),this.performSearch())}}},mounted(){window.addEventListener("global-search",this.handleGlobalSearch),window.addEventListener("global-filters-change",this.handleGlobalFiltersChange);const e=this.route.query.q,t=localStorage.getItem("globalSearchQuery");this.searchQuery=e||t||"";try{const e=localStorage.getItem("globalFilters");e&&(this.filters=JSON.parse(e))}catch(s){console.error("Erreur lors de la restauration des filtres:",s)}this.searchQuery&&this.performSearch()},beforeUnmount(){window.removeEventListener("global-search",this.handleGlobalSearch),window.removeEventListener("global-filters-change",this.handleGlobalFiltersChange)},methods:{handleGlobalSearch(e){const t=e.detail?.q||"";t&&(this.searchQuery=t,this.performSearch())},async performSearch(){if(this.searchQuery){this.isLoading=!0,this.documents=[];try{const e=await this.apiClient.get("/documents/search",{params:{q:this.searchQuery}});console.log("üì• R√©ponse compl√®te de l'API:",e),console.log("üì¶ response.data:",e.data),console.log("üì¶ Type de response.data:",typeof e.data),console.log("üì¶ Est un tableau?",Array.isArray(e.data));let t=[];if(e.data&&e.data.data)t=e.data.data,console.log("‚úÖ Format: response.data.data");else if(Array.isArray(e.data))t=e.data,console.log("‚úÖ Format: response.data (array)");else if(e.data&&"object"===typeof e.data){const s=Object.keys(e.data);console.log("üì¶ Cl√©s disponibles:",s);for(const a of s)if(Array.isArray(e.data[a])){t=e.data[a],console.log(`‚úÖ Format: response.data.${a} (array)`);break}}this.allDocuments=t,this.documents=t,console.log(`‚úÖ ${this.documents.length} document(s) trouv√©(s)`),console.log("üìÑ Documents:",this.documents);const s=Object.keys(this.filters);s.length>0&&s.some(e=>this.filters[e])&&this.applyFilters(this.filters)}catch(e){console.error("‚ùå Erreur lors de la recherche:",e),e&&e.response&&(console.error("‚ùå R√©ponse d'erreur:",e.response.data),console.error("‚ùå Status:",e.response.status)),this.documents=[]}finally{this.isLoading=!1}}},showDocument(e){if(!e)return;const t=e.nom.split(".").pop()?.toLowerCase()||"",s=["png","jpg","jpeg","gif","webp"].includes(t),a=s?"70vw":"50vw";this.dialog.open(D.A,{props:{header:"D√©tails du document",style:{width:a},modal:!0,maximizable:!0,closeOnEscape:!0},data:{document:e,table:"search",source:"search"}})},getFileIcon(e){if(!e)return"fas fa-file";const t=e.split(".").pop()?.toLowerCase(),s={pdf:"fas fa-file-pdf text-danger",doc:"fas fa-file-word text-primary",docx:"fas fa-file-word text-primary",xls:"fas fa-file-excel text-success",xlsx:"fas fa-file-excel text-success",ppt:"fas fa-file-powerpoint text-warning",pptx:"fas fa-file-powerpoint text-warning",jpg:"fas fa-file-image text-info",jpeg:"fas fa-file-image text-info",png:"fas fa-file-image text-info",gif:"fas fa-file-image text-info",zip:"fas fa-file-archive text-secondary",rar:"fas fa-file-archive text-secondary",txt:"fas fa-file-alt text-muted"};return s[t||""]||"fas fa-file"},applyFilters(e){console.log("üîç Application des filtres:",e),this.documents=this.allDocuments.filter(t=>{if(e.type){const s=this.getDocumentType(t.nom);if(s!==e.type)return!1}return(!e.person||t.user_id===e.person)&&(!e.service||t.service_id===e.service)}),console.log(`‚úÖ ${this.documents.length} document(s) apr√®s filtrage`)},getDocumentType(e){if(!e)return"other";const t=e.split(".").pop()?.toLowerCase();return"pdf"===t?"pdf":["jpg","jpeg","png","gif","webp","bmp","svg"].includes(t||"")?"image":["doc","docx"].includes(t||"")?"word":["xls","xlsx"].includes(t||"")?"excel":["ppt","pptx"].includes(t||"")?"powerpoint":["zip","rar","7z","tar","gz"].includes(t||"")?"archive":"txt"===t?"text":"other"},handleGlobalFiltersChange(e){const t=e.detail;console.log("üåç Filtres globaux re√ßus dans GlobalSearchView:",t),this.filters=t,this.applyFilters(t)},formatDate(e){if(!e)return"N/A";const t=new Date(e),s=new Date,a=Math.abs(s.getTime()-t.getTime()),r=Math.ceil(a/864e5);return 0===r?"Aujourd'hui":1===r?"Hier":r<7?`Il y a ${r} jours`:t.toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}}}),F=s(1241);const Q=(0,F.A)(E,[["render",_],["__scopeId","data-v-56630acc"]]);var j=Q}}]);
//# sourceMappingURL=834.2ae273f6.js.map