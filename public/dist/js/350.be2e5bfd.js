"use strict";(self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]=self["webpackChunkskeleton_spa_vue3_bootstrap5_primevue_pwa_ts"]||[]).push([[350],{1804:function(e,t,o){o.d(t,{B:function(){return s},q:function(){return a}});o(4114),o(8111),o(2489),o(7588);var i=o(144);const s=(0,i.Kh)({listeners:{},emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(e=>{e(...t)})},on(e,t){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),()=>{this.listeners[e]=this.listeners[e].filter(e=>e!==t)}},off(e){this.listeners[e]&&delete this.listeners[e]}}),a={DOCUMENT_DELETED:"document:deleted",DOCUMENT_CREATED:"document:created",DOCUMENT_UPDATED:"document:updated",DOCUMENT_RESTORED:"document:restored",DOCUMENT_FORCE_DELETED:"document:force_deleted"}},6350:function(e,t,o){o.r(t),o.d(t,{default:function(){return ee}});var i=o(6768);function s(e,t,o,s,a,n){const r=(0,i.g2)("IndexFavori");return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.bF)(r)])}var a=o(4232);const n={class:"card document-management-card"},r={class:"card-header"},l={class:"card-actions"},c={class:"card-body"},d={class:"file-cell"},u={class:"ms-2"},m={class:"badge bg-secondary"},f={class:"p-2 rounded badge badge-secondary"};function p(e,t,o,s,p,h){const g=(0,i.g2)("FileIcon"),v=(0,i.g2)("AsdecodeTable");return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("div",r,[t[3]||(t[3]=(0,i.Lk)("h1",{class:"card-title"},"Documents Favoris",-1)),(0,i.Lk)("div",l,[(0,i.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...t)=>e.openAddFavoriForm&&e.openAddFavoriForm(...t))},t[2]||(t[2]=[(0,i.Lk)("i",{class:"fas fa-plus"},null,-1),(0,i.eW)(" Ajouter aux favoris ",-1)])),(0,i.Lk)("button",{id:"refreshfavoris",onClick:t[1]||(t[1]=(...t)=>e.refreshData&&e.refreshData(...t)),class:"d-none"},"Rafraîchir")])]),(0,i.Lk)("div",c,[(0,i.bF)(v,{ref:"datatable",columns:e.columns,url:"/api/favoris","api-client":e.apiClient,table:"favoris",onSetTotalRecords:e.updateLines,onRowClick:e.showLine,onSetSelectedRows:e.getSelection,"show-top-stats":!1,"show-bottom-stats":!1},{nom:(0,i.k6)(e=>[(0,i.Lk)("div",d,[(0,i.bF)(g,{fileName:e.data.nom},null,8,["fileName"]),(0,i.Lk)("span",u,(0,a.v_)(e.data.nom),1)])]),type_lisible:(0,i.k6)(t=>[(0,i.Lk)("span",m,(0,a.v_)(e.getFileType(t.data.nom)),1)]),taille:(0,i.k6)(t=>[(0,i.Lk)("span",null,(0,a.v_)(e.formatSize(t.data.taille)),1)]),created_at:(0,i.k6)(e=>[(0,i.Lk)("span",f,(0,a.v_)(new Date(e.data.created_at).toLocaleDateString()),1)]),_:1},8,["columns","api-client","onSetTotalRecords","onRowClick","onSetSelectedRows"])])])}const h={class:"modal-content"},g={key:0,class:"preview-container"},v=["src"],x={key:1,class:"no-preview-text"},E={key:1,class:"preview-container"},b=["data"],D=["href"],F={key:2,class:"document-details"},w={class:"detail-item"},y={class:"detail-text"},k={class:"p-dialog-footer"};function _(e,t,o,s,n,r){const l=(0,i.g2)("Button");return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.Lk)("div",h,[e.isImage?((0,i.uX)(),(0,i.CE)("div",g,[e.imageError?((0,i.uX)(),(0,i.CE)("div",x,"L'aperçu de l'image n'a pas pu être chargé.")):((0,i.uX)(),(0,i.CE)("img",{key:0,src:e.displayUrl,alt:"Aperçu du document",class:"preview-image",onError:t[0]||(t[0]=(...t)=>e.onImageError&&e.onImageError(...t))},null,40,v))])):e.isPdf?((0,i.uX)(),(0,i.CE)("div",E,[(0,i.Lk)("object",{data:e.displayUrl,type:"application/pdf",width:"100%",height:"600px"},[(0,i.Lk)("p",null,[t[2]||(t[2]=(0,i.eW)("Votre navigateur ne supporte pas l'affichage des PDF. Vous pouvez le ",-1)),(0,i.Lk)("a",{href:e.displayUrl,target:"_blank"},"télécharger",8,D),t[3]||(t[3]=(0,i.eW)(".",-1))])],8,b)])):((0,i.uX)(),(0,i.CE)("div",F,[(0,i.Lk)("div",w,[(0,i.Lk)("i",{class:(0,a.C4)(e.getFileIcon(e.document.nom)),style:{"font-size":"2.5rem",color:"var(--primary-color)","margin-right":"1rem"}},null,2),(0,i.Lk)("div",y,[(0,i.Lk)("strong",null,(0,a.v_)(e.document.nom),1),(0,i.Lk)("span",null,(0,a.v_)(e.formatSize(e.document.taille))+" - "+(0,a.v_)(e.getFileType(e.document.nom)),1)])])]))]),(0,i.Lk)("div",k,[(0,i.bF)(l,{label:"Télécharger",icon:"pi pi-download",class:"p-button-success",onClick:e.downloadDocument},null,8,["onClick"]),(0,i.bF)(l,{label:"Retirer des favoris",icon:"pi pi-star",class:"p-button-warning",onClick:e.removeFromFavorites},null,8,["onClick"]),(0,i.bF)(l,{label:"Fermer",icon:"pi pi-times",class:"p-button-secondary",onClick:t[1]||(t[1]=t=>e.closeDialog())})])])}var L=o(2775),C=o(4373),I=o(6587),T=o.n(I),U=o(1804),A=(0,i.pM)({name:"ShowFavorie",components:{Button:L.A},inject:["dialogRef"],data(){console.log("ShowFavorie - dialogRef.data:",this.dialogRef.data);const e=this.dialogRef.data.source||"favoris",t=this.dialogRef.data.table||"favoris";return console.log("ShowFavorie - source initialisée à:",e),console.log("ShowFavorie - table initialisée à:",t),{document:this.dialogRef.data.document,imageError:!1,table:t,isLoading:!1,source:e}},computed:{extension(){return this.document.nom?this.document.nom.split(".").pop().toLowerCase():""},isImage(){return["jpg","jpeg","png","gif","webp"].includes(this.extension)},isPdf(){return"pdf"===this.extension},displayUrl(){return`/api/documents/${this.document.id}/download`}},methods:{closeDialog(e=null){this.dialogRef.close(e)},formatSize(e){if(!e)return"0 Bytes";if(0===e)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+o[i]},getFileType(e){if(!e)return"Inconnu";const t=e.split(".").pop().toLowerCase(),o={png:"Image PNG",jpg:"Image JPG",jpeg:"Image JPEG",gif:"Image GIF",pdf:"Document PDF",doc:"Document Word",docx:"Document Word",xls:"Fichier Excel",xlsx:"Fichier Excel",txt:"Fichier Texte"};return o[t]||`Fichier ${t.toUpperCase()}`},getFileIcon(e){const t=e.split(".").pop().toLowerCase(),o={pdf:"fas fa-file-pdf",doc:"fas fa-file-word",docx:"fas fa-file-word",xls:"fas fa-file-excel",xlsx:"fas fa-file-excel",txt:"fas fa-file-alt"};return o[t]||"fas fa-file"},downloadDocument(){const e=`/api/documents/${this.document.id}/download`,t=document.createElement("a");t.href=e,t.setAttribute("download",this.document.nom),document.body.appendChild(t),t.click(),document.body.removeChild(t)},removeFromFavorites(){this.isLoading=!0,C.A.post(`/api/favoris/${this.document.id}/remove`).then(e=>{this.isLoading=!1,e.data.success?(this.$toast.add({severity:"success",summary:"Succès",detail:"Document retiré des favoris",life:3e3}),this.closeDialog(),T()("#refreshfavoris").click(),U.B.emit(U.q.DOCUMENT_UPDATED,this.document.id)):this.$toast.add({severity:"error",summary:"Erreur",detail:e.data.message||"Erreur lors du retrait des favoris",life:5e3})}).catch(e=>{this.isLoading=!1,console.error("Erreur lors du retrait des favoris:",e),this.$toast.add({severity:"error",summary:"Erreur de connexion",detail:"Une erreur s'est produite lors de la connexion au serveur",life:5e3})})},onImageError(){this.imageError=!0}}}),B=o(1241);const M=(0,B.A)(A,[["render",_],["__scopeId","data-v-4e7ba36c"]]);var S=M,P=o(5130);const j={class:"field mb-3"},R={key:0,class:"field mb-3"},$={class:"document-preview"},N={class:"document-info"},z={class:"d-flex justify-content-end"};function G(e,t,o,s,n,r){const l=(0,i.g2)("Dropdown"),c=(0,i.g2)("Button");return(0,i.uX)(),(0,i.CE)("form",{onSubmit:t[1]||(t[1]=(0,P.D$)((...e)=>r.submitForm&&r.submitForm(...e),["prevent"])),class:"p-fluid"},[(0,i.Lk)("div",j,[t[2]||(t[2]=(0,i.Lk)("label",{for:"document_id"},"Sélectionner un document à ajouter aux favoris",-1)),(0,i.bF)(l,{id:"document_id",modelValue:n.form.document_id,"onUpdate:modelValue":t[0]||(t[0]=e=>n.form.document_id=e),options:n.documents,optionLabel:"nom",optionValue:"id",placeholder:"Sélectionner un document",filter:!0,showClear:!0,required:""},null,8,["modelValue","options"])]),r.selectedDocument?((0,i.uX)(),(0,i.CE)("div",R,[(0,i.Lk)("div",$,[(0,i.Lk)("i",{class:(0,a.C4)([r.getFileIcon(r.selectedDocument.nom),"document-icon"])},null,2),(0,i.Lk)("div",N,[(0,i.Lk)("h5",null,(0,a.v_)(r.selectedDocument.nom),1),(0,i.Lk)("p",null,(0,a.v_)(r.formatSize(r.selectedDocument.taille))+" - "+(0,a.v_)(r.getFileType(r.selectedDocument.nom)),1)])])])):(0,i.Q3)("",!0),(0,i.Lk)("div",z,[(0,i.bF)(c,{type:"submit",label:"Ajouter aux favoris",icon:"pi pi-star",loading:n.isLoading},null,8,["loading"])])],32)}o(8111),o(2489),o(116),o(7588);var O=o(2229),X={name:"FormFavori",components:{Button:L.A,Dropdown:O.A},inject:["dialogRef"],data(){return{isLoading:!1,table:"favoris",documents:[],form:{document_id:null}}},computed:{selectedDocument(){return this.form.document_id?this.documents.find(e=>e.id===this.form.document_id):null}},mounted(){this.fetchDocuments()},methods:{async fetchDocuments(){try{const e=await this.axios.get("/documents/list");e.data.success?this.documents=e.data.data.filter(e=>!e.is_favorite):this.handleError(["Erreur lors du chargement des documents"])}catch(e){console.error("Erreur lors du chargement des documents:",e),this.handleError(["Une erreur est survenue lors du chargement des documents"])}},async submitForm(){if(this.form.document_id){this.isLoading=!0;try{const e=await this.axios.post("/api/favoris/add",{document_id:this.form.document_id});e.data.success?this.handleSuccess(e.data.message||"Document ajouté aux favoris"):this.handleError(e.data.errors||["Erreur lors de l'ajout aux favoris"])}catch(e){console.error(e),this.handleError(["Une erreur de communication est survenue."])}finally{this.isLoading=!1}}else this.$toast.add({severity:"warn",summary:"Attention",detail:"Veuillez sélectionner un document",life:3e3})},handleSuccess(e){this.dialogRef.close(),T()("#refresh"+this.table).click(),this.$toast.add({severity:"success",summary:"Succès",detail:e,life:3e3}),U.B.emit(U.q.DOCUMENT_UPDATED,this.form.document_id)},handleError(e){const t=e||["Une erreur est survenue"];t.forEach(e=>{this.$toast.add({severity:"error",summary:"Erreur",detail:e,life:7e3})})},getFileIcon(e){if(!e)return"fas fa-file";const t=e.split(".").pop().toLowerCase(),o={pdf:"fas fa-file-pdf",doc:"fas fa-file-word",docx:"fas fa-file-word",xls:"fas fa-file-excel",xlsx:"fas fa-file-excel",txt:"fas fa-file-alt",jpg:"fas fa-file-image",jpeg:"fas fa-file-image",png:"fas fa-file-image",gif:"fas fa-file-image"};return o[t]||"fas fa-file"},getFileType(e){if(!e)return"Inconnu";const t=e.split(".").pop().toLowerCase(),o={png:"Image PNG",jpg:"Image JPG",jpeg:"Image JPEG",gif:"Image GIF",pdf:"Document PDF",doc:"Document Word",docx:"Document Word",xls:"Fichier Excel",xlsx:"Fichier Excel",txt:"Fichier Texte"};return o[t]||`Fichier ${t.toUpperCase()}`},formatSize(e){if(!e)return"0 Bytes";if(0===e)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+o[i]}}};const W=(0,B.A)(X,[["render",G],["__scopeId","data-v-6a8bce51"]]);var V=W,q=o(9069),J=o(1526),K=(0,i.pM)({name:"IndexFavorie",components:{FileIcon:q.A},data(){return{apiClient:J.A,lines:0,selection:[],columns:[{key:"nom",label:"Fichier"},{key:"type_lisible",label:"Type"},{key:"taille",label:"Taille"},{key:"created_at",label:"Ajouté le"}]}},methods:{refreshData(){console.log("IndexFavorie: refreshData appelé"),this.$refs.datatable?(console.log("IndexFavorie: référence datatable trouvée, appel de fetchData"),this.$refs.datatable.fetchData()):console.warn("IndexFavorie: référence datatable non trouvée"),this.$nextTick(()=>{setTimeout(()=>{this.$refs.datatable&&(console.log("IndexFavorie: nouvelle tentative de fetchData après nextTick"),this.$refs.datatable.fetchData())},100)})},showLine(e){const t=e.nom.split(".").pop().toLowerCase(),o=["png","jpg","jpeg","gif","webp"].includes(t),i=o?"70vw":"50vw";this.$dialog.open(S,{props:{header:"Détails du document favori",style:{width:i},modal:!0,maximizable:!0,closeOnEscape:!0},data:{document:e,source:"favoris"}})},updateLines(e){this.lines=e},formatSize(e){if(!e)return"0 Bytes";if(0===e)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+o[i]},getFileType(e){if(!e)return"Inconnu";const t=e.split(".").pop().toLowerCase(),o={png:"Image PNG",jpg:"Image JPG",jpeg:"Image JPEG",gif:"Image GIF",pdf:"Document PDF",doc:"Document Word",docx:"Document Word",xls:"Fichier Excel",xlsx:"Fichier Excel",ppt:"Présentation PowerPoint",pptx:"Présentation PowerPoint",zip:"Archive ZIP",rar:"Archive RAR",txt:"Fichier Texte"};return o[t]||`Fichier ${t.toUpperCase()}`},getSelection(e){this.selection=e},openAddFavoriForm(){this.$dialog.open(V,{props:{header:"Ajouter un document aux favoris",style:{width:"50vw"},modal:!0,closeOnEscape:!0}})}},mounted(){this.unsubscribeDelete=U.B.on(U.q.DOCUMENT_DELETED,e=>{console.log("IndexFavorie: Événement DOCUMENT_DELETED reçu avec UUID:",e),this.refreshData()}),this.unsubscribeUpdate=U.B.on(U.q.DOCUMENT_UPDATED,e=>{console.log("IndexFavorie: Événement DOCUMENT_UPDATED reçu avec UUID:",e),this.refreshData()})},unmounted(){this.unsubscribeDelete&&this.unsubscribeDelete(),this.unsubscribeUpdate&&this.unsubscribeUpdate()}});const Q=(0,B.A)(K,[["render",p],["__scopeId","data-v-fd1c7248"]]);var Z=Q,H=(0,i.pM)({name:"FavorieView",components:{IndexFavori:Z}});const Y=(0,B.A)(H,[["render",s],["__scopeId","data-v-0a2949ca"]]);var ee=Y},9069:function(e,t,o){o.d(t,{A:function(){return u}});var i=o(6768),s=o(4232);const a={class:"file-icon-container"},n={key:0,class:"file-extension"};function r(e,t,o,r,l,c){return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.Lk)("div",{class:(0,s.C4)(["file-icon",e.iconClass])},[e.fileExtension?((0,i.uX)(),(0,i.CE)("span",n,(0,s.v_)(e.fileExtension),1)):(0,i.Q3)("",!0)],2)])}var l=(0,i.pM)({name:"FileIcon",props:{fileName:{type:String,required:!0},fileType:{type:String,default:""}},setup(e){const t=e=>{const t=e.split(".");return t.length>1?t[t.length-1].toLowerCase():""},o=(0,i.EW)(()=>{const o=e.fileType.toLowerCase();if(o.includes("pdf")||o.includes("word")||o.includes("excel")||o.includes("powerpoint")||o.includes("image"))return"";const i=t(e.fileName);return i&&i.length<=4?i:""}),s=(0,i.EW)(()=>{const o=e.fileName.toLowerCase(),i=e.fileType.toLowerCase(),s=t(o);return i.includes("image")||["jpg","jpeg","png","gif","webp"].includes(s)?"image-icon":i.includes("pdf")||"pdf"===s?"pdf-icon":i.includes("word")||["doc","docx"].includes(s)?"word-icon":i.includes("excel")||["xls","xlsx","csv"].includes(s)?"excel-icon":i.includes("powerpoint")||["ppt","pptx"].includes(s)?"powerpoint-icon":i.includes("zip")||["zip","rar","7z"].includes(s)?"zip-icon":i.includes("folder")||i.includes("directory")?"folder-icon":i.includes("text")||["txt","md"].includes(s)?"text-icon":"generic-icon"});return{iconClass:s,fileExtension:o}}}),c=o(1241);const d=(0,c.A)(l,[["render",r],["__scopeId","data-v-febcd1ec"]]);var u=d}}]);
//# sourceMappingURL=350.be2e5bfd.js.map